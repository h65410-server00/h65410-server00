import{Q as ee}from"./QPage.dc4591cd.js";import{_ as te}from"./DataGrid.62df3f11.js";import{f as oe,j as se,Q as ae}from"./QInput.479a4d0c.js";import{Q as O}from"./QSeparator.2091df92.js";import{e as ne,f as le,h as re,u as ie,c as F,a as ue,Q as j}from"./QBtn.d13105fa.js";import{a as ce,u as de}from"./use-dark.a7796580.js";import{r as T,c as r,h as v,g as me,y as E,aj as _,k as fe,W as p,X as x,Y as q,j as k,a4 as g,ac as pe,u as i,a0 as Q,a5 as V,F as D,a6 as A,Z as B,ad as ve,x as we}from"./index.c958989c.js";import{Q as ge,a as he}from"./QDialog.f8563754.js";import{freez as y,api as I}from"./axios.38a03c4c.js";import{u as z}from"./app-store.ddb93f8a.js";import{u as be}from"./vue-i18n.runtime.bd082555.js";import"./QMarkupTable.3a2cc66b.js";import"./use-timeout.face0ecb.js";function _e(o,n){const e=T(null),m=r(()=>o.disable===!0?null:v("span",{ref:e,class:"no-outline",tabindex:-1}));function u(f){const w=n.value;f!==void 0&&f.type.indexOf("key")===0?w!==null&&document.activeElement!==w&&w.contains(document.activeElement)===!0&&w.focus():e.value!==null&&(f===void 0||w!==null&&w.contains(f.target)===!0)&&e.value.focus()}return{refocusTargetEl:m,refocusTarget:u}}var ke={xs:30,sm:35,md:40,lg:50,xl:60};const ye={...de,...ie,...oe,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:o=>o==="tf"||o==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},xe=["update:modelValue"];function Ve(o,n){const{props:e,slots:m,emit:u,proxy:f}=me(),{$q:w}=f,$=ce(e,w),R=T(null),{refocusTargetEl:s,refocusTarget:a}=_e(e,R),l=ne(e,ke),c=r(()=>e.val!==void 0&&Array.isArray(e.modelValue)),h=r(()=>{const t=_(e.val);return c.value===!0?e.modelValue.findIndex(b=>_(b)===t):-1}),d=r(()=>c.value===!0?h.value>-1:_(e.modelValue)===_(e.trueValue)),S=r(()=>c.value===!0?h.value===-1:_(e.modelValue)===_(e.falseValue)),P=r(()=>d.value===!1&&S.value===!1),U=r(()=>e.disable===!0?-1:e.tabindex||0),L=r(()=>`q-${o} cursor-pointer no-outline row inline no-wrap items-center`+(e.disable===!0?" disabled":"")+($.value===!0?` q-${o}--dark`:"")+(e.dense===!0?` q-${o}--dense`:"")+(e.leftLabel===!0?" reverse":"")),K=r(()=>{const t=d.value===!0?"truthy":S.value===!0?"falsy":"indet",b=e.color!==void 0&&(e.keepColor===!0||(o==="toggle"?d.value===!0:S.value!==!0))?` text-${e.color}`:"";return`q-${o}__inner relative-position non-selectable q-${o}__inner--${t}${b}`}),H=r(()=>{const t={type:"checkbox"};return e.name!==void 0&&Object.assign(t,{".checked":d.value,"^checked":d.value===!0?"checked":void 0,name:e.name,value:c.value===!0?e.val:e.trueValue}),t}),J=se(H),W=r(()=>{const t={tabindex:U.value,role:o==="toggle"?"switch":"checkbox","aria-label":e.label,"aria-checked":P.value===!0?"mixed":d.value===!0?"true":"false"};return e.disable===!0&&(t["aria-disabled"]="true"),t});function C(t){t!==void 0&&(E(t),a(t)),e.disable!==!0&&u("update:modelValue",X(),t)}function X(){if(c.value===!0){if(d.value===!0){const t=e.modelValue.slice();return t.splice(h.value,1),t}return e.modelValue.concat([e.val])}if(d.value===!0){if(e.toggleOrder!=="ft"||e.toggleIndeterminate===!1)return e.falseValue}else if(S.value===!0){if(e.toggleOrder==="ft"||e.toggleIndeterminate===!1)return e.trueValue}else return e.toggleOrder!=="ft"?e.trueValue:e.falseValue;return e.indeterminateValue}function Y(t){(t.keyCode===13||t.keyCode===32)&&E(t)}function Z(t){(t.keyCode===13||t.keyCode===32)&&C(t)}const G=n(d,P);return Object.assign(f,{toggle:C}),()=>{const t=G();e.disable!==!0&&J(t,"unshift",` q-${o}__native absolute q-ma-none q-pa-none`);const b=[v("div",{class:K.value,style:l.value,"aria-hidden":"true"},t)];s.value!==null&&b.push(s.value);const N=e.label!==void 0?le(m.default,[e.label]):re(m.default);return N!==void 0&&b.push(v("div",{class:`q-${o}__label q-anchor--skip`},N)),v("div",{ref:R,class:L.value,...W.value,onClick:C,onKeydown:Y,onKeyup:Z},b)}}const Re=v("div",{key:"svg",class:"q-checkbox__bg absolute"},[v("svg",{class:"q-checkbox__svg fit absolute-full",viewBox:"0 0 24 24"},[v("path",{class:"q-checkbox__truthy",fill:"none",d:"M1.73,12.91 8.1,19.28 22.79,4.59"}),v("path",{class:"q-checkbox__indet",d:"M4,14H20V10H4"})])]);var Se=F({name:"QCheckbox",props:ye,emits:xe,setup(o){function n(e,m){const u=r(()=>(e.value===!0?o.checkedIcon:m.value===!0?o.indeterminateIcon:o.uncheckedIcon)||null);return()=>u.value!==null?[v("div",{key:"icon",class:"q-checkbox__icon-container absolute-full flex flex-center no-wrap"},[v(ue,{class:"q-checkbox__icon",name:u.value})])]:[Re]}return Ve("checkbox",n)}});const qe=v("div",{class:"q-space"});var Ie=F({name:"QSpace",setup(){return()=>qe}});const M=fe("permissions-store",{state:()=>({data:null,keyword:null,sortkey:"id",permits:null,newRow:null}),getters:{},actions:{}}),$e={class:"q-pb-sm full-width"},Ce={class:"text-caption"},Qe={key:1,class:"text-subtitle1 text-grey text-center"},Be={class:"q-pb-md full-width"},Pe={class:"col"},Ne={class:"row"},Oe={class:"col text-subtitle1 text-grey-7"},je={class:"row"},Ee={class:"row q-pt-md"},De={__name:"NewPermissionDialog",setup(o){const n=z(),e=M(),{t:m}=be(),u=r({get:()=>e.newRow!=null,set:s=>e.newRow=null}),{canDeletePermission:f}=n.permissions;e.newRow.permits||(e.newRow.permits=[]);const w=JSON.parse(JSON.stringify(e.newRow));async function $(){y(!0);try{const s=e.newRow.name,a=e.newRow.permits,l=e.newRow.id;if(l){if(e.newRow.permits!=w.permits){const{id:h}=await I.put(`/permissions/${l}`,{permits:a});e.data.forEach(d=>{d.id==h&&(d.permits=a)})}}else{if(s.length<4||s.length>12)throw new Error("Unvalid data");const{id:c}=await I.post("/permissions",{name:s,permits:a});e.data.push({id:c,i:e.data.length+1,name:s,permits:a})}e.newRow=null}catch(s){console.log(s)}finally{y(!1)}}async function R(){if(!!confirm(m("are_you_sure"))){y(!0);try{const s=e.newRow.id;await I.delete(`/permissions/${s}`),e.data.forEach((a,l)=>{if(a.id==s){e.data.splice(l,1);return}}),e.newRow=null}catch(s){console.log(s)}finally{y(!1)}}}return(s,a)=>(p(),x(he,{modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=l=>u.value=l)},{default:q(()=>[k(ge,{class:"q-pa-md",style:{"max-width":"750px"}},{default:q(()=>[g("form",{onSubmit:pe($,["prevent"])},[g("div",$e,[i(e).newRow.id?(p(),V("div",Qe,Q(i(e).newRow.name),1)):(p(),x(ae,{key:0,modelValue:i(e).newRow.name,"onUpdate:modelValue":a[0]||(a[0]=l=>i(e).newRow.name=l),style:{width:"250px"}},{prepend:q(()=>[g("span",Ce,Q(s.$t("name")+": "),1)]),_:1},8,["modelValue"]))]),k(O),g("div",Be,[(p(!0),V(D,null,A(Object.keys(i(e).permits),l=>(p(),V("div",{key:l,class:"row q-pt-md"},[g("div",Pe,[g("div",Ne,[g("div",Oe,Q(l)+":",1)]),g("div",je,[(p(!0),V(D,null,A(i(e).permits[l],c=>(p(),V("div",{key:c,class:"col-12 col-sm-6 col-md-4"},[k(Se,{color:"teal",modelValue:i(e).newRow.permits,"onUpdate:modelValue":a[1]||(a[1]=h=>i(e).newRow.permits=h),val:c,label:s.$t(c)},null,8,["modelValue","val","label"])]))),128))])])]))),128))]),k(O),g("div",Ee,[i(e).newRow.id&&i(f)?(p(),x(j,{key:0,class:"",label:s.$t("delete"),color:"negative",onClick:R,outline:"",dense:""},null,8,["label"])):B("",!0),k(Ie),k(j,{type:"submit",color:"primary",label:s.$t("save")},null,8,["label"])])],32)]),_:1})]),_:1},8,["modelValue"]))}},Ae={class:"q-pt-lg"},Ge={__name:"PermissionsPage",setup(o){z();const n=M();return ve(async()=>{y(!0);try{const{permissions:e,permits:m}=await I.get("/permissions");n.permits=m,n.data=e.map((u,f)=>(u.i=f+1,u))}catch(e){console.log(e)}finally{y(!1)}}),we(()=>n.$reset()),(e,m)=>(p(),x(ee,{class:"row justify-center"},{default:q(()=>[g("div",Ae,[i(n).data?(p(),x(te,{key:0,getStore:()=>i(n),columns:[{n:"name",w:120}],actionLabel:"New permission",permissionKey:"permissions",style:{"max-height":"80vh"}},null,8,["getStore"])):B("",!0)]),i(n).newRow!=null?(p(),x(De,{key:0})):B("",!0)]),_:1}))}};export{Ge as default};
