import{Q as E}from"./QPage.dc4591cd.js";import{Q as k}from"./QInput.479a4d0c.js";import{Q as v}from"./QBtn.d13105fa.js";import{Q as q,a as z}from"./QDialog.f8563754.js";import{k as C,c as U,W as l,X as _,Y as u,j as c,a4 as d,ac as D,u as a,a5 as y,a0 as V,Z as w,ad as j,x as J}from"./index.c958989c.js";import{freez as r,api as m}from"./axios.38a03c4c.js";import{u as x}from"./app-store.ddb93f8a.js";import{u as M}from"./vue-i18n.runtime.bd082555.js";import{_ as O}from"./DataGrid.62df3f11.js";import"./use-dark.a7796580.js";import"./use-timeout.face0ecb.js";import"./QMarkupTable.3a2cc66b.js";const $=C("items-store",{state:()=>({data:null,keyword:null,sortkey:"id",newRow:null}),getters:{},actions:{}}),P={key:0,class:"q-pb-md full-width text-center"},A={class:"text-caption"},K={key:1,class:"q-pb-md full-width text-center"},L={class:"text-caption"},W={class:"full-width text-center"},X={key:2,class:"full-width text-center q-pt-md"},Y={__name:"NewItemDialog",setup(b){const s=x(),e=$(),{t:p}=M(),g=U({get:()=>e.newRow!=null,set:t=>e.newRow=null}),{canEditItemName:I,canEditItemCount:S,canDeleteItem:Q}=s.permissions,R=JSON.parse(JSON.stringify(e.newRow));async function N(){r(!0);try{const t=e.newRow.name,o=parseInt(e.newRow.count);if(t.length<4||t.length>12||o<0||o>999)throw new Error("Unvalid data");const n=e.newRow.id;if(n){const f=e.newRow;if(f.name!=R.name){const{id:h}=await m.put(`/items/${n}/name`,{name:t});e.data.forEach(i=>{i.id==h&&(i.name=t)})}if(f.count!=R.count){const{id:h}=await m.put(`/items/${n}/count`,{count:o});e.data.forEach(i=>{i.id==h&&(i.count=o)})}}else{const{id:f}=await m.post("/items",{name:t,count:o});e.data.push({id:f,i:e.data.length+1,name:t,count:o})}e.newRow=null}catch(t){console.log(t)}finally{r(!1)}}async function B(){if(!!confirm(p("are_you_sure"))){r(!0);try{const t=e.newRow.id;await m.delete(`/items/${t}`),e.data.forEach((o,n)=>{if(o.id==t){e.data.splice(n,1);return}}),e.newRow=null}catch(t){console.log(t)}finally{r(!1)}}}return(t,o)=>(l(),_(z,{modelValue:g.value,"onUpdate:modelValue":o[2]||(o[2]=n=>g.value=n)},{default:u(()=>[c(q,{class:"q-pa-md text-center",style:{width:"250px"}},{default:u(()=>[d("form",{onSubmit:D(N,["prevent"]),class:"freez"},[a(I)||!a(e).newRow.id?(l(),y("div",P,[c(k,{modelValue:a(e).newRow.name,"onUpdate:modelValue":o[0]||(o[0]=n=>a(e).newRow.name=n),class:"freez"},{prepend:u(()=>[d("span",A,V(t.$t("name")+": "),1)]),_:1},8,["modelValue"])])):w("",!0),a(S)||!a(e).newRow.id?(l(),y("div",K,[c(k,{type:"number",modelValue:a(e).newRow.count,"onUpdate:modelValue":o[1]||(o[1]=n=>a(e).newRow.count=n),autocomplete:"off",class:"freez"},{prepend:u(()=>[d("span",L,V(t.$t("count")+": "),1)]),_:1},8,["modelValue"])])):w("",!0),d("div",W,[c(v,{type:"submit",class:"full-width",color:"primary",label:t.$t("save")},null,8,["label"])]),a(Q)&&a(e).newRow.id?(l(),y("div",X,[c(v,{class:"full-width freez",label:t.$t("delete"),color:"negative",onClick:B,outline:"",dense:""},null,8,["label"])])):w("",!0)],32)]),_:1})]),_:1},8,["modelValue"]))}},Z={class:"q-pt-lg"},ie={__name:"IndexPage",setup(b){x();const s=$();return j(async()=>{r(!0);try{s.data=(await m.get("/items")).map((e,p)=>(e.i=p+1,e))}catch(e){console.log(e)}finally{r(!1)}}),J(()=>s.$reset()),(e,p)=>(l(),_(E,{class:"row justify-center"},{default:u(()=>[d("div",Z,[a(s).data?(l(),_(O,{key:0,getStore:()=>a(s),columns:[{n:"name",w:200},{n:"count",w:100,v:0}],actionLabel:"New item",permissionKey:"items",style:{"max-height":"80vh"}},null,8,["getStore"])):w("",!0)]),a(s).newRow!=null?(l(),_(Y,{key:0})):w("",!0)]),_:1}))}};export{ie as default};
